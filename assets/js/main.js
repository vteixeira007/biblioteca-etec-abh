/*! For license information please see main.js.LICENSE.txt */
!function(){var e={633:function(e,t,n){var r=n(738).default;function o(){"use strict";e.exports=o=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},a=Object.prototype,i=a.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",d=s.toStringTag||"@@toStringTag";function p(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,n){return e[t]=n}}function m(e,t,n,r){var o=t&&t.prototype instanceof x?t:x,a=Object.create(o.prototype),i=new P(r||[]);return c(a,"_invoke",{value:B(e,n,i)}),a}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=m;var h="suspendedStart",f="suspendedYield",g="executing",b="completed",y={};function x(){}function E(){}function w(){}var k={};p(k,u,(function(){return this}));var L=Object.getPrototypeOf,A=L&&L(L(j([])));A&&A!==a&&i.call(A,u)&&(k=A);var C=w.prototype=x.prototype=Object.create(k);function I(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(o,a,c,s){var u=v(e[o],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==r(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,c,s)}),(function(e){n("throw",e,c,s)})):t.resolve(d).then((function(e){l.value=e,c(l)}),(function(e){return n("throw",e,c,s)}))}s(u.arg)}var o;c(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}})}function B(e,n,r){var o=h;return function(a,i){if(o===g)throw Error("Generator is already running");if(o===b){if("throw"===a)throw i;return{value:t,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var s=S(c,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=b,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=g;var u=v(e,n,r);if("normal"===u.type){if(o=r.done?b:f,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=b,r.method="throw",r.arg=u.arg)}}}function S(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var a=v(o,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return E.prototype=w,c(C,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:E,configurable:!0}),E.displayName=p(w,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,d,"GeneratorFunction")),e.prototype=Object.create(C),e},n.awrap=function(e){return{__await:e}},I(T.prototype),p(T.prototype,l,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,o,a){void 0===a&&(a=Promise);var i=new T(m(e,t,r,o),a);return n.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},I(C),p(C,d,"Generator"),p(C,u,(function(){return this})),p(C,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=j,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},738:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756:function(e,t,n){var r=n(633)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";function e(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(o,a){var i=t.apply(n,r);function c(t){e(i,o,a,c,s,"next",t)}function s(t){e(i,o,a,c,s,"throw",t)}c(void 0)}))}}var r=n(756),o=n.n(r);var a="https://biblioteca-etec-abh-2.onrender.com";function i(e){alert(e)}function c(){i("Sessão expirada ou inválida. Faça login novamente."),window.location.href="login.html"}function s(e,t,n){t.innerHTML='<option class="option" value="">'.concat(n,"</option>"),e&&e.length>0&&e.forEach((function(e){var n=document.createElement("option");n.value=e.idCategoria,n.textContent=e.nome,n.setAttribute("data-nome",e.nome),n.className="option",t.appendChild(n)}))}function u(){return l.apply(this,arguments)}function l(){return(l=t(o().mark((function e(){var t,n,r,i,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("authToken")){e.next=3;break}return e.abrupt("return",c());case 3:return n=document.getElementById("selectCategoriaAtualizar"),r=document.getElementById("selectCategoriaExcluir"),n&&(n.disabled=!0),r&&(r.disabled=!0),e.prev=7,e.next=10,fetch("".concat(a,"/categoria"),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});case 10:if(401!==(i=e.sent).status){e.next=13;break}return e.abrupt("return",c());case 13:if(i.ok){e.next=15;break}throw new Error("Erro ".concat(i.status," ao buscar."));case 15:return e.next=17,i.json();case 17:u=e.sent,n&&s(u,n,"-- Selecione para Atualizar --"),r&&s(u,r,"-- Selecione para Excluir --"),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),console.error("Erro ao carregar categorias:",e.t0);case 25:return e.prev=25,n&&(n.disabled=!1),r&&(r.disabled=!1),e.finish(25);case 29:case"end":return e.stop()}}),e,null,[[7,22,25,29]])})))).apply(this,arguments)}function d(){var e=document.getElementById("selectCategoriaAtualizar"),t=e.value,n=document.getElementById("divCamposNovoNome"),r=document.getElementById("btnSubmitAtualizarCategoria"),o=document.getElementById("nomeAtualCategoriaDisplayAtt"),a=document.getElementById("novoNomeCategoriaInputAtt"),i=document.getElementById("categoriaIdAtt");if(t&&n&&r&&o&&a&&i){var c=e.options[e.selectedIndex].getAttribute("data-nome");i.value=t,o.value=c,a.value=c,n.style.display="block",r.style.display="block",a.focus()}else n&&(n.style.display="none",r&&(r.style.display="none"),i&&(i.value=""),o&&(o.value=""),a&&(a.value=""))}function p(e){return m.apply(this,arguments)}function m(){return(m=t(o().mark((function e(t){var n,r,s,l,p,m,v,h,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=localStorage.getItem("authToken")){e.next=4;break}return e.abrupt("return",c());case 4:if(r=document.getElementById("categoriaIdAtt").value,s=document.getElementById("novoNomeCategoriaInputAtt").value.trim(),r&&s){e.next=9;break}return i("Por favor, selecione uma categoria e preencha o novo nome."),e.abrupt("return");case 9:if(!(s.length>40)){e.next=12;break}return i("O nome da categoria deve ter no máximo 40 caracteres."),e.abrupt("return");case 12:return l=document.getElementById("btnSubmitAtualizarCategoria"),p=l.textContent,l.disabled=!0,l.textContent="Atualizando...",e.prev=16,e.next=19,fetch("".concat(a,"/categoria/").concat(r),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({nome:s})});case 19:if(401!==(m=e.sent).status){e.next=22;break}return e.abrupt("return",c());case 22:return e.next=24,m.text();case 24:if(v=e.sent,m.ok){e.next=29;break}h=v;try{f=JSON.parse(v),h=f.message||JSON.stringify(f)}catch(e){}throw new Error("Erro ".concat(m.status,": ").concat(h));case 29:return i("Categoria atualizada com sucesso!"),document.getElementById("formAtualizarCategoria").reset(),document.getElementById("categoriaIdAtt").value="",document.getElementById("selectCategoriaAtualizar").value="",d(),e.next=36,u();case 36:e.next=42;break;case 38:e.prev=38,e.t0=e.catch(16),console.error("Erro ao atualizar categoria:",e.t0),i("Erro ao atualizar categoria: ".concat(e.t0.message));case 42:return e.prev=42,l.disabled=!1,l.textContent=p,e.finish(42);case 46:case"end":return e.stop()}}),e,null,[[16,38,42,46]])})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=t(o().mark((function e(t){var n,r,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=localStorage.getItem("authToken")){e.next=4;break}return e.abrupt("return",c());case 4:if(r=document.getElementById("selectCategoriaExcluir"),s=r.value){e.next=9;break}return i("Por favor, selecione uma categoria para excluir."),e.abrupt("return");case 9:if(confirm("Tem certeza que deseja excluir a categoria selecionada (Nome: ".concat(r.options[r.selectedIndex].text,")? Esta ação não pode ser desfeita e removerá os livros associados."))){e.next=11;break}return e.abrupt("return");case 11:return e.prev=11,e.next=14,fetch("".concat(a,"/categoria/").concat(s),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}});case 14:if(401!==(l=e.sent).status){e.next=17;break}return e.abrupt("return",c());case 17:if(l.ok){e.next=19;break}throw new Error("Erro ".concat(l.status," ao deletar."));case 19:return i("Categoria deletada com sucesso!"),e.next=22,u();case 22:r.value="",e.next=29;break;case 25:e.prev=25,e.t0=e.catch(11),console.error("Erro ao deletar categoria:",e.t0),i("Erro ao deletar categoria. ".concat(e.t0.message));case 29:case"end":return e.stop()}}),e,null,[[11,25]])})))).apply(this,arguments)}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var b=function(){var e=localStorage.getItem("authToken"),t=(window.location.pathname.split("/").pop()||"index.html").toLowerCase();console.log("%c[AUTH] Iniciando verificação. Página: ".concat(t,". Token no localStorage: ").concat(e?"Existe":"NÃO Existe"),"color: #007bff; font-weight: bold;");var n=function(e){if(!e)return console.warn("[Auth - parseJwt] Tentativa de parsear token nulo ou indefinido."),null;try{var t=e.split(".")[1];if(!t)return console.error("[Auth - parseJwt] Token JWT inválido: Estrutura sem payload (parte [1]). Token:",e),null;var n=t.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(n).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(r)}catch(t){return console.error("[Auth - parseJwt] Erro ao decodificar/parsear o token JWT. Token:",e,"Erro:",t),null}}(e),r=n&&n.exp&&"number"==typeof n.exp&&1e3*n.exp>Date.now();return console.log("[AUTH] Payload do token decodificado:",n),console.log("[AUTH] O token é considerado válido? ".concat(r)),r?(console.log("[Auth] Token VÁLIDO."),"login.html"===t?(console.error("[Auth] Usuário LOGADO, mas na página de login. REDIRECIONANDO para index.html."),window.location.href="index.html",!1):(console.log("[Auth] Usuário LOGADO e na página correta (não login). Permitindo prosseguir."),!0)):(e?(localStorage.removeItem("authToken"),console.warn("[Auth] Token INVÁLIDO ou EXPIRADO. Token removido do localStorage."),n&&n.exp&&"number"==typeof n.exp&&1e3*n.exp<=Date.now()?alert("Sua sessão expirou. Por favor, faça login novamente."):null===n&&e&&alert("Houve um problema ao validar sua sessão (token malformado). Por favor, faça login novamente.")):console.warn("[Auth] Nenhum token encontrado no localStorage."),"login.html"!==t?(console.error("[Auth] Usuário NÃO LOGADO e não está na página de login. REDIRECIONANDO para login.html."),window.location.href="login.html",!1):(console.log("[Auth] Usuário NÃO LOGADO, mas já está na página de login. Permitindo prosseguir (exibir formulário de login)."),!1))}();document.addEventListener("DOMContentLoaded",(function(){console.log("[App.js] DOM Carregado."),function(){var e=document.getElementById("btn-mobile");if(e){var t=function(e){"touchstart"===e.type&&e.preventDefault();var t=document.getElementById("nav");if(t){t.classList.toggle("active");var n=t.classList.contains("active");e.currentTarget.setAttribute("aria-expanded",n),n?e.currentTarget.setAttribute("aria-label","Fechar Menu"):e.currentTarget.setAttribute("aria-label","Abrir Menu")}else console.warn("[Menu] Elemento #nav não encontrado.")};e.addEventListener("click",t),e.addEventListener("touchstart",t)}else console.warn("[Menu] Elemento #btn-mobile não encontrado nesta página. Menu mobile não inicializado.")}();var e,n,r,a,i=(window.location.pathname.split("/").pop()||"index.html").toLowerCase();console.log("[App.js] Página atual: ".concat(i,". Resultado do auth.js: ").concat(b)),b?i.includes("login.html")?console.warn("[App.js] Estado inesperado: podeProsseguirNaPaginaAtual é true, mas estamos em login.html."):(console.log("[App.js] Autenticado e não na página de login. Carregando scripts de funcionalidade para ".concat(i,"...")),new Promise((function(e){function n(e){alert(e)}function r(){var e=localStorage.getItem("authToken");if(!e)return console.error("[CadastroLivros] ERRO CRÍTICO: Token não encontrado na inicialização."),n("Erro de autenticação. Tente fazer login novamente."),void(window.location.href="login.html");var r=document.getElementById("categoria-select"),a=document.getElementById("livroForm");r&&fetch("https://biblioteca-etec-abh-2.onrender.com/categoria",{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){if(!e.ok)throw new Error("Erro ".concat(e.status," ao carregar categorias."));return e.json()})).then((function(e){r.innerHTML='<option value="">Selecione uma categoria</option>',e.forEach((function(e){var t=document.createElement("option");t.value=e.idCategoria,t.textContent=e.nome,r.appendChild(t)}))})).catch((function(e){console.error("Erro ao carregar categorias:",e)})),a&&a.addEventListener("submit",function(){var e=t(o().mark((function e(t){var i,c,s,u,l,d,p,m,v,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),i=localStorage.getItem("authToken")){e.next=6;break}return n("Sessão expirada. Redirecionando para login."),window.location.href="login.html",e.abrupt("return");case 6:c=a.querySelector('button[type="submit"]'),s=c?c.textContent:"Cadastrar",c&&(c.disabled=!0,c.textContent="Enviando..."),e.prev=9,u={},l=0,d=["tituloLivro","autoresLivro","assuntoLivro","codigoLivro","quantidadeLivro"];case 13:if(!(l<d.length)){e.next=21;break}if(p=d[l],(m=document.getElementById(p))&&m.value.trim()){e.next=18;break}throw new Error("Por favor, preencha o campo: ".concat((null==m?void 0:m.placeholder)||p));case 18:l++,e.next=13;break;case 21:if(r&&r.value){e.next=23;break}throw new Error("Por favor, selecione uma categoria");case 23:if(!((u={titulo:document.getElementById("tituloLivro").value.trim(),autor:document.getElementById("autoresLivro").value.trim(),assunto:document.getElementById("assuntoLivro").value.trim(),descricao:document.getElementById("descricaoLivro").value.trim()||"Sem descrição",codigo:document.getElementById("codigoLivro").value.trim(),quantidade:parseInt(document.getElementById("quantidadeLivro").value,10),status:"DISPONIVEL",idCategoria:parseInt(r.value,10)}).codigo.length>13)){e.next=26;break}throw new Error("O código do livro não pode ter mais que 13 caracteres");case 26:if(!(isNaN(u.quantidade)||u.quantidade<1)){e.next=28;break}throw new Error("A quantidade deve ser um número maior que zero");case 28:return e.next=30,fetch("https://biblioteca-etec-abh-2.onrender.com/livro",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(u)});case 30:if((v=e.sent).ok){e.next=36;break}return e.next=34,v.text();case 34:throw h=e.sent,new Error(h||"Erro ".concat(v.status," ao cadastrar livro"));case 36:return n("Livro cadastrado com sucesso!"),a.reset(),e.next=40,window.listarLivrosGlobais();case 40:e.next=46;break;case 42:e.prev=42,e.t0=e.catch(9),console.error("Erro ao cadastrar livro:",e.t0),n(e.t0.message||"Erro ao cadastrar livro. Tente novamente.");case 46:return e.prev=46,c&&(c.disabled=!1,c.textContent=s),e.finish(46);case 49:case"end":return e.stop()}}),e,null,[[9,42,46,49]])})));return function(t){return e.apply(this,arguments)}}())}window.listarLivrosGlobais=t(o().mark((function e(){var t,r,a,i,c,s,u,l,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("authToken")){e.next=5;break}return n("Sessão expirada ou inválida. Redirecionando para login."),window.location.href="login.html",e.abrupt("return");case 5:return r=document.getElementById("listaLivros"),(a=document.getElementById("btnListarLivros"))&&(a.textContent="Carregando...",a.disabled=!0),r&&(r.innerHTML="Carregando livros..."),e.prev=9,e.next=12,fetch("https://biblioteca-etec-abh-2.onrender.com/categoria",{headers:{Authorization:"Bearer ".concat(t)}});case 12:if((i=e.sent).ok){e.next=15;break}throw new Error("Erro ".concat(i.status," ao buscar dados."));case 15:return e.next=17,i.json();case 17:c=e.sent,r&&((s=document.createElement("table")).className="tabela-categoria",(u=document.createElement("thead")).innerHTML="\n            <tr>\n              <th>ID</th> <th>Título</th> <th>Autor</th> <th>Assunto</th> <th>Código</th>\n              <th>Qtd</th> <th>Status</th> <th>Categoria</th> <th>Ações</th>\n            </tr>\n          ",s.appendChild(u),l=document.createElement("tbody"),d=!1,c.forEach((function(e){e.bookResponses&&Array.isArray(e.bookResponses)&&e.bookResponses.forEach((function(e){d=!0;var t=document.createElement("tr");t.innerHTML="\n                  <td>".concat(e.idLivro||"N/A","</td>\n                  <td>").concat(e.titulo||"N/A","</td>\n                  <td>").concat(e.autor||"N/A","</td>\n                  <td>").concat(e.assunto||"N/A","</td>\n                  <td>").concat(e.codigo||"N/A","</td>\n                  <td>").concat(e.quantidade||"N/A","</td>\n                  <td>").concat(e.status||"N/A","</td>\n                  <td>").concat(e.nomeCategoria||"N/A",'</td>\n                  <td>\n                    <button class="btn-delete" onclick="window.deletarLivroGlobal(').concat(e.idLivro,')"> \n                      Deletar\n                    </button>\n                  </td>\n                '),l.appendChild(t)}))})),s.appendChild(l),r.innerHTML="",d?r.appendChild(s):r.innerHTML="<p>Nenhum livro encontrado.</p>"),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(9),console.error("Erro ao listar livros:",e.t0),r&&(r.innerHTML='<p class="error">Erro ao carregar a lista. Tente novamente.</p>');case 25:return e.prev=25,a&&(a.textContent="Listar Livros",a.disabled=!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[9,21,25,28]])}))),window.deletarLivroGlobal=function(){var e=t(o().mark((function e(t){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage.getItem("authToken")){e.next=5;break}return n("Sessão expirada. Redirecionando para login."),window.location.href="login.html",e.abrupt("return");case 5:if(confirm("Tem certeza que deseja deletar este livro?")){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,fetch("https://biblioteca-etec-abh-2.onrender.com/livro/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});case 10:if((a=e.sent).ok){e.next=13;break}throw new Error("Erro ".concat(a.status," ao deletar livro."));case 13:return n("Livro deletado com sucesso!"),e.next=16,window.listarLivrosGlobais();case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("Erro ao deletar livro:",e.t0),n("Erro ao deletar livro. Tente novamente.");case 22:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(t){return e.apply(this,arguments)}}();var a=document.getElementById("btnListarLivros");a&&a.addEventListener("click",window.listarLivrosGlobais),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){r(),window.listarLivrosGlobais()})):(r(),window.listarLivrosGlobais()),e()})),new Promise((function(e){var n="https://biblioteca-etec-abh-2.onrender.com",r=[],a=document.getElementById("categoria-select"),i=document.getElementById("atualizarLivroForm"),c=document.getElementById("pesquisarLivro"),s=document.getElementById("sugestoes-livros"),u=document.getElementById("listaLivros"),l=document.getElementById("btnListarLivros");function d(e){alert(e)}function p(){d("Sessão expirada ou inválida. Faça login novamente."),window.location.href="login.html"}function m(){return v.apply(this,arguments)}function v(){return(v=t(o().mark((function e(){var t,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("authToken")){e.next=3;break}return e.abrupt("return",p());case 3:return e.prev=3,e.next=6,fetch("".concat(n,"/categoria"),{headers:{Authorization:"Bearer ".concat(t)}});case 6:if(401!==(i=e.sent).status){e.next=9;break}return e.abrupt("return",p());case 9:if(i.ok){e.next=11;break}throw new Error("Erro ".concat(i.status," ao buscar."));case 11:return e.next=13,i.json();case 13:c=e.sent,r=[],c.forEach((function(e){e.bookResponses&&Array.isArray(e.bookResponses)&&e.bookResponses.forEach((function(t){t.nomeCategoria=e.nome,t.idCategoria=e.idCategoria,r.push(t)}))})),a&&h(c,t),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),console.error("Erro ao carregar todos os livros:",e.t0);case 22:case"end":return e.stop()}}),e,null,[[3,19]])})))).apply(this,arguments)}function h(e,t){return f.apply(this,arguments)}function f(){return(f=t(o().mark((function e(t,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&t.length>0)){e.next=4;break}g(t,a),e.next=23;break;case 4:if(r||(r=localStorage.getItem("authToken")),r){e.next=7;break}return e.abrupt("return",p());case 7:return e.prev=7,e.next=10,fetch("".concat(n,"/categoria"),{headers:{Authorization:"Bearer ".concat(r)}});case 10:if(401!==(i=e.sent).status){e.next=13;break}return e.abrupt("return",p());case 13:if(i.ok){e.next=15;break}throw new Error("Erro ".concat(i.status," ao buscar categorias."));case 15:return e.next=17,i.json();case 17:g(e.sent,a),e.next=23;break;case 21:e.prev=21,e.t0=e.catch(7);case 23:case"end":return e.stop()}}),e,null,[[7,21]])})))).apply(this,arguments)}function g(e,t){t.innerHTML='<option value="">Selecione uma categoria</option>',e.forEach((function(e){var n=document.createElement("option");n.value=e.idCategoria,n.textContent=e.nome,t.appendChild(n)}))}function b(e){if(i){document.getElementById("livroId").value=e.idLivro,document.getElementById("tituloLivro").value=e.titulo||"",document.getElementById("autoresLivro").value=e.autor||"",document.getElementById("assuntoLivro").value=e.assunto||"",document.getElementById("descricaoLivro").value=e.descricao||"",document.getElementById("codigoLivro").value=e.codigo||"",document.getElementById("quantidadeLivro").value=e.quantidade||1,a&&e.idCategoria&&(a.value=e.idCategoria);var t=document.getElementById("statusLivro");t&&e.status&&(t.value=e.status),i.style.display="block"}}function y(e){return x.apply(this,arguments)}function x(){return(x=t(o().mark((function e(t){var r,s,u,l,v,h,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),r=localStorage.getItem("authToken")){e.next=4;break}return e.abrupt("return",p());case 4:if(s=document.getElementById("livroId").value){e.next=8;break}return d("Nenhum livro selecionado para atualizar."),e.abrupt("return");case 8:if(document.getElementById("tituloLivro").value.trim()){e.next=11;break}return d("O título é obrigatório."),e.abrupt("return");case 11:return u={idLivro:parseInt(s,10),titulo:document.getElementById("tituloLivro").value.trim(),autor:document.getElementById("autoresLivro").value.trim(),assunto:document.getElementById("assuntoLivro").value.trim(),descricao:document.getElementById("descricaoLivro").value.trim()||"Sem descrição",codigo:document.getElementById("codigoLivro").value.trim(),quantidade:parseInt(document.getElementById("quantidadeLivro").value,10),status:document.getElementById("statusLivro").value,idCategoria:parseInt(a.value,10)},l=i.querySelector('button[type="submit"]'),v=l.textContent,l.disabled=!0,l.textContent="Atualizando...",e.prev=16,e.next=19,fetch("".concat(n,"/livro/").concat(s),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(u)});case 19:if(401!==(h=e.sent).status){e.next=22;break}return e.abrupt("return",p());case 22:if(h.ok){e.next=27;break}return e.next=25,h.text();case 25:throw f=e.sent,new Error(f||"Erro ".concat(h.status," ao atualizar."));case 27:return d("Livro atualizado com sucesso!"),i.reset(),i.style.display="none",c&&(c.value=""),e.next=33,m();case 33:return e.next=35,listarLivrosGlobaisAtt();case 35:e.next=41;break;case 37:e.prev=37,e.t0=e.catch(16),console.error("Erro ao atualizar livro:",e.t0),d("Erro ao atualizar: ".concat(e.t0.message));case 41:return e.prev=41,l.disabled=!1,l.textContent=v,e.finish(41);case 45:case"end":return e.stop()}}),e,null,[[16,37,41,45]])})))).apply(this,arguments)}function E(){if(!localStorage.getItem("authToken"))return p();m().then((function(){listarLivrosGlobaisAtt()})),c&&s&&c.addEventListener("input",(function(){var e=c.value.trim().toLowerCase();if(s.innerHTML="",e.length<2)s.style.display="none";else{var t=r.filter((function(t){return t.titulo.toLowerCase().includes(e)||t.codigo.toLowerCase().includes(e)}));t.length>0?(s.style.display="block",t.slice(0,6).forEach((function(e){var t=document.createElement("div");t.className="sugestao-item",t.textContent="".concat(e.titulo," (").concat(e.codigo,")"),t.onclick=function(){c.value=e.titulo,s.style.display="none",b(e)},s.appendChild(t)}))):s.style.display="none"}})),i&&i.addEventListener("submit",y),l&&l.addEventListener("click",listarLivrosGlobaisAtt)}window.listarLivrosGlobaisAtt=t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("authToken")){e.next=3;break}return e.abrupt("return",p());case 3:if(u){e.next=5;break}return e.abrupt("return");case 5:if(l&&(l.textContent="Carregando...",l.disabled=!0),u.innerHTML="Carregando livros...",e.prev=7,0!==r.length){e.next=11;break}return e.next=11,m();case 11:(t=document.createElement("table")).className="tabela-categoria",t.innerHTML="\n          <thead>\n            <tr>\n              <th>ID</th> <th>Título</th> <th>Autor</th> <th>Código</th>\n              <th>Qtd</th> <th>Status</th> <th>Categoria</th> <th>Ações</th>\n            </tr>\n          </thead>\n          <tbody>\n            ".concat(r.map((function(e){return"\n              <tr>\n                <td>".concat(e.idLivro||"N/A","</td>\n                <td>").concat(e.titulo||"N/A","</td>\n                <td>").concat(e.autor||"N/A","</td>\n                <td>").concat(e.codigo||"N/A","</td>\n                <td>").concat(e.quantidade||"N/A","</td>\n                <td>").concat(e.status||"N/A","</td>\n                <td>").concat(e.nomeCategoria||"N/A",'</td>\n                <td>\n                  <button class="btn-edit" onclick="window.selecionarLivroParaAtualizarGlobal(').concat(e.idLivro,')"> \n                    Editar\n                  </button>\n                </td>\n              </tr>\n            ')})).join(""),"\n          </tbody>\n        "),u.innerHTML="",r.length>0?u.appendChild(t):u.innerHTML="<p>Nenhum livro encontrado.</p>",e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("Erro ao listar livros:",e.t0),u.innerHTML='<p class="error">Erro ao carregar a lista. Tente novamente.</p>';case 22:return e.prev=22,l&&(l.textContent="Listar Todos",l.disabled=!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,18,22,25]])}))),window.selecionarLivroParaAtualizarGlobal=function(e){var t=r.find((function(t){return t.idLivro===e}));t?(window.scrollTo({top:0,behavior:"smooth"}),b(t)):d("Livro com ID ".concat(e," não encontrado na lista local. Tente recarregar."))},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",E):E(),e()})),new Promise((function(e,n){console.log("[AlunosAPI - Cadastro] Função importCadastroAlunos INICIADA!");var r="https://biblioteca-etec-abh-2.onrender.com";function a(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("[AlunosAPI - Cadastro] Mensagem: ".concat(e," (Erro: ").concat(t,")")),alert((t?"Erro: ":"")+e)}function i(){a(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sessão expirada ou inválida. Faça login novamente.",!0),setTimeout((function(){window.location.href="login.html"}),500)}function c(){console.log("[AlunosAPI - Cadastro] Validando campos do formulário...");for(var e=0,t=["nome","matricula","cpf","email","telefone","curso","turma"];e<t.length;e++){var n,r=t[e],o=document.getElementById(r);if(!o||!o.value.trim())return a("Por favor, preencha o campo: ".concat((null==o||null===(n=o.labels)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.textContent)||(null==o?void 0:o.placeholder)||r),!0),!1}var i=document.getElementById("matricula").value.trim(),c=Number(i);return isNaN(c)||c<=0?(a("Matrícula inválida. Deve ser um número positivo.",!0),!1):(console.log("[AlunosAPI - Cadastro] Validação de campos OK."),!0)}function s(){return u.apply(this,arguments)}function u(){return(u=t(o().mark((function e(){var t,n,a,c,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[AlunosAPI - Cadastro] Tentando listar alunos..."),t=localStorage.getItem("authToken")){e.next=4;break}return e.abrupt("return",i());case 4:if(n=document.getElementById("listaAlunos"),a=document.getElementById("btnListarAlunos"),n){e.next=9;break}return console.warn("[AlunosAPI - Cadastro] Div #listaAlunos não encontrada para listar."),e.abrupt("return");case 9:return a&&(a.textContent="Carregando...",a.disabled=!0),n.innerHTML="Carregando alunos...",e.prev=11,e.next=14,fetch("".concat(r,"/aluno"),{headers:{Authorization:"Bearer ".concat(t)}});case 14:if(401!==(c=e.sent).status){e.next=17;break}return e.abrupt("return",i("Não autorizado (401) ao listar alunos."));case 17:if(c.ok){e.next=19;break}throw new Error("Erro ".concat(c.status," ao carregar alunos."));case 19:return e.next=21,c.json();case 21:s=e.sent,console.log("[AlunosAPI - Cadastro] Alunos recebidos:",s),n.innerHTML="",(u=document.createElement("table")).className="tabela-alunos",u.innerHTML="\n                <thead>\n                    <tr>\n                        <th>ID</th> <th>Nome</th> <th>Matrícula</th> <th>CPF</th>\n                        <th>Email</th> <th>Telefone</th> <th>Curso</th> <th>Turma</th>\n                        <th>Ações</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ".concat(s.map((function(e){return"\n                        <tr>\n                            <td>".concat(e.idAluno||"N/A","</td>\n                            <td>").concat(e.nome||"N/A","</td>\n                            <td>").concat(e.matricula||"N/A","</td>\n                            <td>").concat(e.cpf||"N/A","</td>\n                            <td>").concat(e.email||"N/A","</td>\n                            <td>").concat(e.telefone||"N/A","</td>\n                            <td>").concat(e.curso||"N/A","</td>\n                            <td>").concat(e.turma||"N/A",'</td>\n                            <td>\n                                <button class="btn-delete" onclick="window.deletarAlunoGlobalCadastro(').concat(e.idAluno,')">\n                                    Deletar\n                                </button>\n                            </td>\n                        </tr>\n                    ')})).join(""),"\n                </tbody>\n            "),0===s.length?n.innerHTML="<p>Nenhum aluno cadastrado.</p>":n.appendChild(u),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(11),console.error("[AlunosAPI - Cadastro] Erro ao listar alunos:",e.t0),n.innerHTML='<p class="error">Erro ao carregar alunos. Tente novamente.</p>';case 34:return e.prev=34,a&&(a.textContent="Listar Alunos",a.disabled=!1),e.finish(34);case 37:case"end":return e.stop()}}),e,null,[[11,30,34,37]])})))).apply(this,arguments)}function l(){if(console.log("[AlunosAPI - Cadastro] Inicializando página de cadastro de alunos..."),!localStorage.getItem("authToken"))return console.error("[AlunosAPI - Cadastro] ERRO CRÍTICO INICIAL: Token não encontrado. Isso não deveria acontecer se auth.js funcionou. Redirecionando..."),i(),n(new Error("Token ausente na inicialização de CadastroAlunos"));var u=document.getElementById("formCadastroAluno"),l=document.getElementById("btnListarAlunos");u?(console.log("[AlunosAPI - Cadastro] Adicionando listener ao #formCadastroAluno."),u.addEventListener("submit",function(){var e=t(o().mark((function e(t){var n,u,l,d,p,m,v,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),console.log("[AlunosAPI - Cadastro] Formulário de cadastro submetido."),n=localStorage.getItem("authToken")){e.next=5;break}return e.abrupt("return",i());case 5:if(u=this.querySelector('button[type="submit"]'),l=u?u.textContent:"Cadastrar",u&&(u.disabled=!0,u.textContent="Cadastrando..."),c()){e.next=11;break}return u&&(u.disabled=!1,u.textContent=l),e.abrupt("return");case 11:return d={nome:document.getElementById("nome").value.trim(),matricula:Number(document.getElementById("matricula").value.trim()),cpf:document.getElementById("cpf").value.replace(/\D/g,""),email:document.getElementById("email").value.trim(),telefone:document.getElementById("telefone").value.replace(/\D/g,""),curso:document.getElementById("curso").value.trim(),turma:document.getElementById("turma").value.trim()},console.log("[AlunosAPI - Cadastro] Dados para cadastrar:",d),e.prev=13,e.next=16,fetch("".concat(r,"/aluno"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(d)});case 16:if(401!==(p=e.sent).status){e.next=19;break}return e.abrupt("return",i("Não autorizado (401) ao cadastrar aluno."));case 19:return e.next=21,p.text();case 21:if(m=e.sent,p.ok){e.next=26;break}v=m;try{h=JSON.parse(m),v=h.message||h.error||JSON.stringify(h)}catch(e){}throw new Error("Erro ".concat(p.status,": ").concat(v));case 26:return a("Aluno cadastrado com sucesso!"),this.reset(),e.next=30,s();case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(13),console.error("[AlunosAPI - Cadastro] Erro no submit do cadastro:",e.t0),a("Erro ao cadastrar aluno: ".concat(e.t0.message),!0);case 36:return e.prev=36,u&&(u.disabled=!1,u.textContent=l),e.finish(36);case 39:case"end":return e.stop()}}),e,this,[[13,32,36,39]])})));return function(t){return e.apply(this,arguments)}}())):console.warn("[AlunosAPI - Cadastro] Formulário #formCadastroAluno não encontrado."),l?(console.log("[AlunosAPI - Cadastro] Adicionando listener ao #btnListarAlunos."),l.addEventListener("click",s),s()):console.warn("[AlunosAPI - Cadastro] Botão #btnListarAlunos não encontrado."),console.log("[AlunosAPI - Cadastro] Configuração da página de cadastro de alunos concluída."),e()}window.deletarAlunoGlobalCadastro=function(){var e=t(o().mark((function e(t){var n,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[AlunosAPI - Cadastro] Tentando deletar aluno ID: ".concat(t)),n=localStorage.getItem("authToken")){e.next=4;break}return e.abrupt("return",i());case 4:if(confirm("Tem certeza que deseja deletar este aluno?")){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,fetch("".concat(r,"/aluno/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}});case 9:if(401!==(c=e.sent).status){e.next=12;break}return e.abrupt("return",i("Não autorizado (401) ao deletar aluno."));case 12:if(c.ok){e.next=14;break}throw new Error("Erro ".concat(c.status," ao deletar aluno."));case 14:return a("Aluno deletado com sucesso!"),e.next=17,s();case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),console.error("[AlunosAPI - Cadastro] Erro ao deletar aluno:",e.t0),a("Erro ao deletar aluno. Tente novamente.",!0);case 23:case"end":return e.stop()}}),e,null,[[6,19]])})));return function(t){return e.apply(this,arguments)}}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})),new Promise((function(e){var n="https://biblioteca-etec-abh-2.onrender.com",r=document.getElementById("pesquisaAluno"),a=document.getElementById("btnAtualizar"),i=document.getElementById("student-suggestions"),c=document.getElementById("cpf"),s=document.getElementById("telefone"),u=document.getElementById("matricula"),l=null;function d(e){alert(e)}function p(){d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sessão expirada ou inválida. Faça login novamente."),window.location.href="login.html"}function m(){var e=!0,t="";return["nome","cpf","email","telefone","matricula","curso","turma"].forEach((function(n){var r=document.getElementById(n);if(r){var o,a=r.value.trim();r.classList.remove("input-error"),a||(r.classList.add("input-error"),e=!1,t||(t=(null===(o=r.previousElementSibling)||void 0===o?void 0:o.textContent)||n))}else console.warn("[AttAlunos] Validação: Campo ".concat(n," não encontrado.")),e=!1})),e||d("Por favor, preencha corretamente o campo ".concat(t)),e}function v(){return(v=t(o().mark((function e(t){var r,a,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage.getItem("authToken")){e.next=3;break}return e.abrupt("return",p());case 3:return e.prev=3,e.next=6,fetch("".concat(n,"/aluno?nome=").concat(encodeURIComponent(t)),{headers:{Authorization:"Bearer ".concat(r)}});case 6:if(401!==(a=e.sent).status){e.next=9;break}return e.abrupt("return",p());case 9:if(a.ok){e.next=11;break}throw new Error("Erro ".concat(a.status," ao buscar."));case 11:return e.next=13,a.json();case 13:c=e.sent,i&&(i.innerHTML="",0===c.length?i.innerHTML='<div class="suggestion-item no-results">Nenhum aluno encontrado.</div>':c.forEach((function(e){var t=document.createElement("div");t.textContent="".concat(e.nome," (Mat: ").concat(e.matricula,")"),t.className="suggestion-item",t.onclick=function(){return h(e.idAluno)},i.appendChild(t)}))),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.error("Erro ao buscar alunos:",e.t0),d("Erro ao buscar alunos.");case 21:case"end":return e.stop()}}),e,null,[[3,17]])})))).apply(this,arguments)}function h(e){return f.apply(this,arguments)}function f(){return(f=t(o().mark((function e(t){var a,c,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=localStorage.getItem("authToken")){e.next=3;break}return e.abrupt("return",p());case 3:return l=null,i&&(i.innerHTML=""),e.prev=5,e.next=8,fetch("".concat(n,"/aluno/").concat(t),{headers:{Authorization:"Bearer ".concat(a)}});case 8:if(401!==(c=e.sent).status){e.next=11;break}return e.abrupt("return",p());case 11:if(c.ok){e.next=13;break}throw new Error("Erro ".concat(c.status," ao carregar dados."));case 13:return e.next=15,c.json();case 15:if(s=e.sent){e.next=18;break}throw new Error("Nenhum dado recebido");case 18:l=t,["nome","cpf","email","telefone","matricula","curso","turma"].forEach((function(e){var t=document.getElementById(e);t&&(t.value=s[e]||"")})),r&&(r.value=s.nome),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(5),console.error("Erro ao carregar dados do aluno:",e.t0),d("Erro ao carregar dados do aluno.");case 28:case"end":return e.stop()}}),e,null,[[5,24]])})))).apply(this,arguments)}function g(){return(g=t(o().mark((function e(t){var i,c,s,u,v,h,f,g,b,y,x,E,w;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),i=localStorage.getItem("authToken")){e.next=4;break}return e.abrupt("return",p());case 4:if(l){e.next=7;break}return d("Nenhum aluno selecionado para atualizar."),e.abrupt("return");case 7:if(m()){e.next=9;break}return e.abrupt("return");case 9:return s=(c=a).textContent,c.disabled=!0,c.textContent="Atualizando...",e.prev=13,x={nome:null===(u=document.getElementById("nome"))||void 0===u?void 0:u.value.trim(),matricula:null===(v=document.getElementById("matricula"))||void 0===v?void 0:v.value.replace(/\D/g,""),cpf:null===(h=document.getElementById("cpf"))||void 0===h?void 0:h.value.replace(/\D/g,""),email:null===(f=document.getElementById("email"))||void 0===f?void 0:f.value.trim(),telefone:null===(g=document.getElementById("telefone"))||void 0===g?void 0:g.value.replace(/\D/g,""),curso:null===(b=document.getElementById("curso"))||void 0===b?void 0:b.value.trim(),turma:null===(y=document.getElementById("turma"))||void 0===y?void 0:y.value.trim()},e.next=17,fetch("".concat(n,"/aluno/").concat(l),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(x)});case 17:if(401!==(E=e.sent).status){e.next=20;break}return e.abrupt("return",p());case 20:if(E.ok){e.next=25;break}return e.next=23,E.text();case 23:throw w=e.sent,new Error("Erro ".concat(E.status,": ").concat(w||"Falha ao atualizar"));case 25:return e.next=27,E.text();case 27:d(e.sent||"Dados atualizados com sucesso!"),l=null,r&&(r.value=""),e.next=37;break;case 33:e.prev=33,e.t0=e.catch(13),console.error("Erro ao atualizar aluno:",e.t0),d("Erro ao atualizar aluno: ".concat(e.t0.message));case 37:return e.prev=37,c.disabled=!1,c.textContent=s,e.finish(37);case 41:case"end":return e.stop()}}),e,null,[[13,33,37,41]])})))).apply(this,arguments)}r&&r.addEventListener("input",(function(){var e=this.value;e.length>=3?function(e){v.apply(this,arguments)}(e):i&&(i.innerHTML="")})),a&&a.addEventListener("click",(function(e){return g.apply(this,arguments)})),c&&c.addEventListener("input",(function(e){var t=e.target.value.replace(/\D/g,"").slice(0,11);t=(t=(t=t.replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d{1,2})$/,"$1-$2"),e.target.value=t,e.target.classList.remove("input-error")})),s&&s.addEventListener("input",(function(e){var t=e.target.value.replace(/\D/g,"").slice(0,11);t=(t=t.replace(/^(\d{2})(\d)/g,"($1) $2")).replace(/(\d)(\d{4})$/,"$1-$2"),e.target.value=t,e.target.classList.remove("input-error")})),u&&u.addEventListener("input",(function(e){e.target.value=e.target.value.replace(/\D/g,""),e.target.classList.remove("input-error")})),e()})),new Promise((function(e){if(!localStorage.getItem("authToken"))return console.error("[AddCategoria] ERRO CRÍTICO: Token não encontrado. Isso não deveria acontecer. Redirecionando..."),alert("Ocorreu um erro de autenticação. Tente fazer login novamente."),void(window.location.href="login.html");function n(e){alert(e)}var r=document.getElementById("formCadastroCategorias");function a(){return i.apply(this,arguments)}function i(){return(i=t(o().mark((function e(){var t,r,a,i,c,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("authToken")){e.next=5;break}return n("Sessão perdida. Redirecionando para login."),window.location.href="login.html",e.abrupt("return");case 5:return r=document.getElementById("listaCategorias"),(a=document.getElementById("btnListarCategorias"))&&(a.textContent="Carregando...",a.disabled=!0),e.prev=8,e.next=11,fetch("https://biblioteca-etec-abh-2.onrender.com/categoria",{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});case 11:if((i=e.sent).ok){e.next=14;break}throw new Error("Erro ".concat(i.status," ao buscar categorias."));case 14:return e.next=16,i.json();case 16:c=e.sent,r&&((s=document.createElement("table")).className="tabela-categoria",s.innerHTML="\n            <thead>\n              <tr>\n                <th>ID</th>\n                <th>Nome</th>\n                <th>Ações</th>\n              </tr>\n            </thead>\n            <tbody>\n              ".concat(c.map((function(e){return"\n                <tr>\n                  <td>".concat(e.idCategoria,"</td>\n                  <td>").concat(e.nome,'</td>\n                  <td>\n                    <button onclick="window.deletarCategoriaGlobais(').concat(e.idCategoria,')" class="btn-delete">\n                      Deletar\n                    </button>\n                  </td>\n                </tr>\n              ')})).join(""),"\n            </tbody>\n          "),r.innerHTML="",r.appendChild(s)),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(8),console.error("Erro ao listar:",e.t0),r&&(r.innerHTML='<p class="error">Erro ao carregar a lista.</p>');case 24:return e.prev=24,a&&(a.textContent="Listar Categorias",a.disabled=!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[8,20,24,27]])})))).apply(this,arguments)}window.deletarCategoriaGlobais=function(){var e=t(o().mark((function e(t){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage.getItem("authToken")){e.next=5;break}return n("Sessão perdida. Redirecionando para login."),window.location.href="login.html",e.abrupt("return");case 5:if(confirm("Tem certeza que deseja deletar esta categoria?")){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,fetch("https://biblioteca-etec-abh-2.onrender.com/categoria/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});case 10:if((i=e.sent).ok){e.next=13;break}throw new Error("Erro ".concat(i.status," ao deletar."));case 13:return alert("Categoria deletada com sucesso!"),e.next=16,a();case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("Erro ao deletar:",e.t0),alert("Erro ao deletar categoria.");case 22:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(t){return e.apply(this,arguments)}}(),r&&r.addEventListener("submit",function(){var e=t(o().mark((function e(t){var r,i,c,s,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),r=localStorage.getItem("authToken")){e.next=6;break}return n("Sessão perdida. Redirecionando para login."),window.location.href="login.html",e.abrupt("return");case 6:if(i=this.querySelector('button[type="submit"]'),c=i.textContent,i.disabled=!0,i.textContent="Cadastrando...",void 0,(o=document.getElementById("nomeCategoria").value.trim())?!(o.length>40)||(n("O nome da categoria deve ter no máximo 40 caracteres."),0):(n("Por favor, preencha o nome da categoria."),0)){e.next=14;break}return i.disabled=!1,i.textContent=c,e.abrupt("return");case 14:return s={nome:document.getElementById("nomeCategoria").value.trim()},e.prev=15,e.next=18,fetch("https://biblioteca-etec-abh-2.onrender.com/categoria",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(s)});case 18:return u=e.sent,e.next=21,u.text();case 21:if(l=e.sent,u.ok){e.next=24;break}throw new Error("Erro ao cadastrar: ".concat(u.status," - ").concat(l));case 24:return n("Categoria cadastrada com sucesso!"),this.reset(),e.next=28,a();case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(15),console.error("Erro no submit:",e.t0),n("Erro ao cadastrar categoria. ".concat(e.t0.message));case 34:return e.prev=34,i.disabled=!1,i.textContent=c,e.finish(34);case 38:case"end":return e.stop()}var o}),e,this,[[15,30,34,38]])})));return function(t){return e.apply(this,arguments)}}());var c=document.getElementById("btnListarCategorias");c&&(c.addEventListener("click",a),a()),e()})),n=document.getElementById("selectCategoriaAtualizar"),r=document.getElementById("formAtualizarCategoria"),a=document.getElementById("formExcluirCategoriaAtt"),n&&n.addEventListener("change",d),r&&r.addEventListener("submit",p),a&&a.addEventListener("submit",v),u(),function(){var e="https://biblioteca-etec-abh-2.onrender.com";function n(e,t){t?t.innerHTML='<p class="error">'.concat(e,"</p>"):alert(e)}function r(e){n("Sessão expirada ou inválida. Faça login novamente.",e),setTimeout((function(){window.location.href="login.html"}),1500)}function a(){return i.apply(this,arguments)}function i(){return(i=t(o().mark((function t(){var a,i,c,s,u,l,d,p,m,v,h,g;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=document.getElementById("livrosContainer")){t.next=3;break}return t.abrupt("return");case 3:if(a.innerHTML="<p>Carregando detalhes do livro...</p>",i=localStorage.getItem("authToken")){t.next=7;break}return t.abrupt("return",r(a));case 7:if(c=new URLSearchParams(window.location.search),s=c.get("idLivro")){t.next=12;break}return n("ID do Livro não especificado na URL.",a),t.abrupt("return");case 12:return t.prev=12,t.next=15,fetch("".concat(e,"/categoria"),{headers:{Authorization:"Bearer ".concat(i)}});case 15:if(401!==(u=t.sent).status){t.next=18;break}return t.abrupt("return",r(a));case 18:if(u.ok){t.next=20;break}throw new Error("Erro ".concat(u.status," ao buscar dados dos livros."));case 20:return t.next=22,u.json();case 22:l=t.sent,d=null,p="Categoria não encontrada",m=f(l),t.prev=26,m.s();case 28:if((v=m.n()).done){t.next=38;break}if(!(h=v.value).bookResponses||!Array.isArray(h.bookResponses)){t.next=36;break}if(!(g=h.bookResponses.find((function(e){return e.idLivro.toString()===s})))){t.next=36;break}return d=g,p=h.nome||p,t.abrupt("break",38);case 36:t.next=28;break;case 38:t.next=43;break;case 40:t.prev=40,t.t0=t.catch(26),m.e(t.t0);case 43:return t.prev=43,m.f(),t.finish(43);case 46:if(d){t.next=49;break}return n("Livro não encontrado.",a),t.abrupt("return");case 49:d.nomeCategoria||(d.nomeCategoria=p),a.innerHTML='\n        <div class="livro-content">\n          <div class="livro-content_banner">\n            <div class="livro-content_image">\n              <img src="./assets/images/capa.jpg" alt="Capa do livro '.concat(d.titulo,'" />\n            </div>\n            <div class="livro-content_tag">\n              <span>').concat("DISPONIVEL"===d.status?"Disponível":d.status||"N/A",'</span>\n            </div>\n          </div>\n          <div class="livro-content_text">\n            <div class="livro-content_text-categoria">\n              <h3>').concat(d.nomeCategoria||"Sem Categoria","</h3>\n              <span>").concat(d.assunto||"Sem assunto específico","</span>\n            </div>\n            <h1>").concat(d.titulo||"Título Indisponível","</h1>\n            <h2>Por: ").concat(d.autor||"Autor Desconhecido",'</h2>\n            <div class="livro-content_submenu">\n              <div class="livro-content_submenu-numbers">\n                <span class="livro-content_submenu_subtitulo_number_ano">Ano: ').concat(d.dataCriacao?new Date(d.dataCriacao).getFullYear():"-",'</span>\n                </div>\n              <div class="livro-content_submenu-codes">\n                <span class="livro-content_submenu-codes-isbn13"><span>EAN / ISBN13:</span> ').concat(d.codigo||"-",'</span>\n              </div>\n              <div class="livro-content_submenu-data">\n                <span class="livro-content_submenu-data-add">Adicionado em: ').concat(d.dataCriacao?new Date(d.dataCriacao).toLocaleDateString():"-",'</span>\n                <span class="livro-content_submenu-data-att">Atualizado em: ').concat(d.dataAtuallizacao?new Date(d.dataAtuallizacao).toLocaleDateString():"-",'</span>\n              </div>\n              <span class="livro-content_submenu-copias">Cópias disponíveis: <span>').concat(void 0!==d.quantidade?d.quantidade:"-",'</span></span>\n            </div>\n            <div class="subtitulo page-livro">\n              <span class="subtitulo-text">Descrição</span>\n              <div class="line subtitulo"></div>\n            </div>\n            <div class="livro-content_text-description">\n              <p>').concat(d.descricao||"Nenhuma descrição disponível.","</p>\n            </div>\n          </div>\n        </div>\n      "),t.next=56;break;case 53:t.prev=53,t.t1=t.catch(12),n("Erro ao carregar os detalhes do livro. Tente novamente.",a);case 56:case"end":return t.stop()}}),t,null,[[12,53],[26,40,43,46]])})))).apply(this,arguments)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}(),function(){var e=[],n=document.getElementById("homeLivrosContainer"),r=document.querySelector(".home-pesquisa_input"),a=document.querySelectorAll(".home-pesquisa_alfabeto ul li a");function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Sessão expirada ou inválida.";console.error("[pageLivros] Erro de Autenticação: ".concat(e)),n&&(n.innerHTML='<p class="error">'.concat(e,' Por favor, <a href="login.html">faça login</a> novamente.</p>'))}function c(e){if(n)if(n.innerHTML="",0!==e.length){var t={};e.forEach((function(e){var n="#";e&&e.titulo&&"string"==typeof e.titulo?(n=e.titulo.charAt(0).toUpperCase()).match(/[A-Z]/i)||(n="#"):console.warn("[pageLivros] Livro sem título ou título inválido:",e),t[n]||(t[n]=[]),t[n].push(e)})),Object.keys(t).sort((function(e,t){return"#"===e?1:"#"===t?-1:e.localeCompare(t)})).forEach((function(e){var r=document.createElement("div");r.classList.add("home-content_letra"),r.innerHTML="<span>".concat(e,'</span><div class="line"></div>'),n.appendChild(r);var o=document.createElement("div");o.classList.add("home-content_livros"),t[e].sort((function(e,t){return(e.titulo||"").localeCompare(t.titulo||"")})).forEach((function(e){var t=document.createElement("div");t.classList.add("home-content_livro"),t.innerHTML='\n          <a class="home-content_capa-link" href="descricao-livro.html?idLivro='.concat(e.idLivro,'">\n            <div class="home-content_capa">\n              <img src="./assets/images/capa.jpg" alt="Capa do livro ').concat(e.titulo||"Sem título",'">\n              <div class="overlay">\n                <img src="./assets/images/icons/info.svg" alt="Informações do livro">\n              </div>\n            </div>\n          </a>\n          <span class="home-content_livro-titulo">').concat(e.titulo||"Sem título",'</span>\n          <span class="home-content_livro-descricao">').concat(e.autor||"Autor desconhecido","</span>\n        "),o.appendChild(t)})),n.appendChild(o)}))}else n.innerHTML="<p>Nenhum livro encontrado com os critérios selecionados.</p>";else console.error("[pageLivros] ERRO: Container #homeLivrosContainer NÃO ENCONTRADO para mostrar livros.")}function s(){if(!r)return console.warn("[pageLivros] Input de pesquisa não encontrado para filtro."),void c(e);var t=r.value.trim().toLowerCase(),n=document.querySelector(".home-pesquisa_alfabeto ul li a.ativo"),o=n?n.textContent.toLowerCase():"todos",a=e;t&&(a=a.filter((function(e){return e.titulo&&e.titulo.toLowerCase().includes(t)||e.autor&&e.autor.toLowerCase().includes(t)}))),o&&"todos"!==o&&(a="#"===o?a.filter((function(e){if(!e.titulo)return!0;var t=e.titulo.charAt(0).toLowerCase();return!/[a-z]/i.test(t)})):a.filter((function(e){return e.titulo&&e.titulo.toLowerCase().startsWith(o)}))),c(a)}function u(){return(u=t(o().mark((function t(){var r,a,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=3;break}return console.error("[pageLivros] ERRO CRÍTICO: Container #homeLivrosContainer NÃO ENCONTRADO no início de _carregarTodosLivros."),t.abrupt("return");case 3:if(n.innerHTML="<p>Carregando livros...</p>",r=localStorage.getItem("authToken")){t.next=8;break}return i("Token não encontrado para carregar livros."),t.abrupt("return");case 8:return t.prev=8,t.next=11,fetch("".concat("https://biblioteca-etec-abh-2.onrender.com","/categoria"),{headers:{Authorization:"Bearer ".concat(r)}});case 11:if(401!==(a=t.sent).status){t.next=15;break}return i("Não autorizado (401) ao buscar livros."),t.abrupt("return");case 15:if(a.ok){t.next=17;break}throw new Error("Erro ".concat(a.status," ao buscar dados dos livros."));case 17:return t.next=19,a.json();case 19:s=t.sent,e=[],s.forEach((function(t){t.bookResponses&&Array.isArray(t.bookResponses)&&t.bookResponses.forEach((function(n){n.nomeCategoria=t.nome,e.push(n)}))})),0===e.length?n.innerHTML="<p>Nenhum livro disponível no momento.</p>":c(e),t.next=29;break;case 25:t.prev=25,t.t0=t.catch(8),console.error("[pageLivros] ERRO em _carregarTodosLivros:",t.t0),n.innerHTML='<p class="error">Erro ao carregar os livros: '.concat(t.t0.message,". Tente novamente.</p>");case 29:case"end":return t.stop()}}),t,null,[[8,25]])})))).apply(this,arguments)}r?r.addEventListener("input",s):console.warn("[pageLivros] Elemento de input de pesquisa não encontrado."),a.length>0&&a.forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault(),a.forEach((function(e){return e.classList.remove("ativo")})),e.classList.add("ativo"),s()}))})),function(){u.apply(this,arguments)}()}()):i.includes("login.html")?(console.log("[App.js] Na página de login (não autenticado, ou auth.js está redirecionando para index). Carregando script 'login.js' para o formulário."),(e=document.getElementById("login-form"))?(console.log("[Login.js] Formulário #login-form encontrado. Adicionando listener de submit."),e.addEventListener("submit",function(){var n=t(o().mark((function t(n){var r,a,i,c,s,u,l,d,p,m,v,h;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),console.log("[Login.js] Formulário de login submetido."),r=document.getElementById("login-login"),a=document.getElementById("login-password"),i=e.querySelector('button[type="submit"]'),r&&a){t.next=8;break}return alert("Erro interno: Campos de login não encontrados."),t.abrupt("return");case 8:if(c=r.value.trim(),s=a.value.trim(),c&&s){t.next=13;break}return alert("Por favor, preencha o usuário e a senha."),t.abrupt("return");case 13:return u=i?i.textContent:"Entrar",i&&(i.disabled=!0,i.textContent="Entrando..."),t.prev=15,console.log("[Login.js] Enviando requisição para https://biblioteca-etec-abh-2.onrender.com/auth/login com usuário: ".concat(c)),t.next=19,fetch("https://biblioteca-etec-abh-2.onrender.com/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:c,password:s})});case 19:if(l=t.sent,console.log("[Login.js] Resposta da API de login: Status ".concat(l.status,", OK: ").concat(l.ok)),!l.ok){t.next=29;break}return t.next=24,l.json();case 24:d=t.sent,console.log("[Login.js] Resposta JSON da API (sucesso):",d),d.token||d.access_token?(p=d.token||d.access_token,console.log("%c[Login.js] Token recebido da API:","color: green; font-weight: bold;",p),localStorage.setItem("authToken",p),console.log("[Login.js] Token salvo. Redirecionando para index.html..."),window.location.href="index.html"):(console.error("[Login.js] Resposta OK da API, mas sem token no corpo:",d),alert("Login falhou: Resposta inesperada do servidor."),i&&(i.disabled=!1,i.textContent=u)),t.next=43;break;case 29:return m="Erro ".concat(l.status,": ").concat(l.statusText||"Falha no login"),t.prev=30,t.next=33,l.text();case 33:if(v=t.sent)try{h=JSON.parse(v),m=h.message||h.error||JSON.stringify(h)}catch(e){m=v}t.next=40;break;case 37:t.prev=37,t.t0=t.catch(30),console.error("[Login.js] Erro ao ler corpo da resposta de erro:",t.t0);case 40:console.error("[Login.js] Falha no login. Servidor respondeu com erro.",m),alert("Login inválido! ".concat(m)),i&&(i.disabled=!1,i.textContent=u);case 43:t.next=50;break;case 45:t.prev=45,t.t1=t.catch(15),console.error("[Login.js] Erro crítico na requisição de login (ex: rede):",t.t1),alert("Erro ao conectar com o servidor. Verifique sua conexão e tente novamente."),i&&(i.disabled=!1,i.textContent=u);case 50:case"end":return t.stop()}}),t,null,[[15,45],[30,37]])})));return function(e){return n.apply(this,arguments)}}())):console.warn("[Login.js] Formulário #login-form não encontrado nesta página.")):console.warn("[App.js] 'podeProsseguirNaPaginaAtual' é false e não estamos em login.html. Provável redirecionamento por auth.js em curso para login.html."),console.log("[App.js] Fim do processamento inicial.")}))}()}();